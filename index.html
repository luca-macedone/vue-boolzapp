<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boolzapp | Boolean</title>
    <!-- FontAwesome 6.2.0 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap 5.2.3 css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- Bootstrap 5.2.3 js -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <!-- My Style -->
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body class="bg-dual">
    <div class="ms-container bg-light" id="app">
        <div class="ms-row">
            <div class="ms-col ms-w-40 border-end">
                <header class="d-flex align-items-center p-2 ms-bg-grey-light" id="left-header">
                    <div class="user h-100 d-flex align-items-center gap-2">
                        <img class="img-fluid rounded-circle" src="./assets/img/avatar_io.jpg" height="60" width="60"
                            alt="">
                        <span>Sofia</span>
                    </div>
                    <!-- /.user -->
                    <div class="user-controls h-100 d-flex justify-content-end align-items-center gap-3 pe-3">
                        <i class="fa-solid fa-circle-notch ms-text-grey-dark"></i>
                        <i class="fa-solid fa-message ms-text-grey-dark"></i>
                        <i class="fa fa-ellipsis-v ms-text-grey-dark"></i>
                    </div>
                    <!-- /.user-controls -->
                </header>
                <!-- /#left-header -->
                <div class="notifications-check w-100 ms-bg-info d-flex gap-2 align-items-center p-2">
                    <span class="rounded-circle p-2 bg-light">
                        <i class="fa fa-bell-slash ms-text-info m-1" aria-hidden="true"></i>
                    </span>
                    <div class="d-flex flex-column">
                        <span>Ricevi notifiche di nuovi messaggi</span>
                        <small class="text-decoration-underline text-secondary">Attive notifiche desktop</small>
                    </div>
                </div>
                <!-- /.notifications-check -->
                <div class="search-bar p-2">
                    <div class="input-group">
                        <button class="btn border-0 bg-white">
                            <i class="fa-solid fa-magnifying-glass ms-text-grey-dark"></i>
                        </button>
                        <input class="form-control border-0 ms-text-sm" type="text" id="searchbar"
                            placeholder="Cerca o inizia una nuova chat" v-model="filterValue">
                        <button :class="filterValue !== ''? '' : 'd-none'" class="btn bg-white text-danger"
                            @click="filterValue = ''">
                            <i class="fa-solid fa-x"></i>
                        </button>
                    </div>
                </div>
                <!-- /.search-bar -->
                <main class="bg-white" id="left-main">
                    <ul class="list-group rounded-0 chat-list">
                        <li v-if="filteredContacts.length == 0"
                            class="list-group-item list-group-item-action border-0 border-top rounded-0 d-flex justify-content-between align-items-start chat-user"
                            :class="index === activeChat? 'activeChat':''" v-for="(chat_contact, index) in contacts"
                            @click="changeActiveChat(index)">
                            <img class="rounded-circle" :src='`./assets/img/.${chat_contact.avatar}`' width="60"
                                height="60" alt="">
                            <div class="d-flex flex-column ps-3 w-75">
                                <span>{{chat_contact.name}}</span>
                                <small class="ms-text-grey-dark">{{latestMessage(index)}}</small>
                            </div>
                            <span class="ms-text-sm ms-text-grey-dark">{{latestMessageHour(index)}}</span>
                        </li>
                        <!-- /.chat-user not-filtered -->
                        <li v-else
                            class="list-group-item list-group-item-action border-0 border-top rounded-0 d-flex justify-content-between align-items-start chat-user"
                            :class="index === activeChat? 'activeChat':''"
                            v-for="(chat_contact, index) in filteredContacts" @click="changeActiveChat(index)">
                            <img class="rounded-circle" :src='`./assets/img/.${chat_contact.avatar}`' width="60"
                                height="60" alt="">
                            <div class="d-flex flex-column ps-3 w-75">
                                <span>{{chat_contact.name}}</span>
                                <small class="ms-text-grey-dark">{{latestMessage(index)}}</small>
                            </div>
                            <span class="ms-text-sm ms-text-grey-dark">{{latestMessageHour(index)}}</span>
                        </li>
                        <!-- /.chat-user filtered-->
                    </ul>
                    <!-- /.chat-list -->
                </main>
                <!-- /#left-main -->
            </div>
            <!-- /.col -->
            <div class="ms-col ms-w-60 ms-bg-chat">
                <header class="d-flex align-items-center p-2 ms-bg-grey-light" id="right-header">
                    <div v-if="activeChat !== -1" class="user h-100 d-flex align-items-center gap-2">
                        <img class="img-fluid rounded-circle" :src="`./assets/img/.${contacts[activeChat].avatar}`"
                            height="60" width="60" alt="">
                        <div class="d-flex flex-column">
                            <span>{{contacts[activeChat].name}}</span>
                            <small class="ms-text-grey-dark fw-light">Ultimo accesso oggi alle 12:00</small>
                        </div>
                    </div>
                    <!-- /.user -->
                    <div v-if="activeChat !== -1"
                        class="user-controls h-100 d-flex justify-content-end align-items-center gap-3 pe-3">
                        <i class="fa-solid fa-magnifying-glass ms-text-grey-dark"></i>
                        <i class="fa-solid fa-paperclip ms-text-grey-dark"></i>
                        <i class="fa fa-ellipsis-v ms-text-grey-dark"></i>
                    </div>
                    <!-- /.user-controls -->
                </header>
                <!-- /#right-header -->
                <main id="right-main">
                    <ul class="list-group-flush list-unstyled d-flex flex-column gap-2 p-5">
                        <li v-if="activeChat !== -1" class="w-100"
                            v-for="(message, index) in contacts[activeChat].messages">
                            <div class=" ms-w-46 rounded p-3 message position-relative"
                                :class="message.status === 'sent'? 'float-end':'float-start'">
                                <div class="dropdown ms-text-sm ms-text-grey-darker message-menu">
                                    <i class="fa fa-angle-down" data-bs-toggle="dropdown"></i>
                                    <ul class="dropdown-menu rounded-0 border-0 shadow px-2 py-3">
                                        <li class="ms-text-sm">
                                            <span class="dropdown-item ms-text-grey-darker">Message info</span>
                                        </li>
                                        <li class="ms-text-sm">
                                            <span class="dropdown-item ms-text-grey-darker"
                                                @click="deleteMessage(index)">Delete message</span>
                                        </li>
                                    </ul>
                                </div>
                                {{message.message}}
                                <div class="ms-text-sm ms-text-grey-darker hour">{{setHour(message.date)}}</div>
                            </div>
                        </li>
                    </ul>
                    <div v-if="activeChat === -1" :class="activeChat !== -1? 'd-none' : 'd-block'">
                        <div class="card ms-bg-chat ms-text-grey-dark border-0 w-50 m-auto">
                            <div class="card-body">
                                <h5 class="card-title">Choose someone to talk with</h5>
                                <small class="card-text">Search someone on the left panel to talk with</small>
                            </div>
                        </div>
                    </div>
                </main>
                <!-- /#right-main -->
                <footer :class="activeChat !== -1? '': 'd-none'"
                    class="d-flex justify-content-between align-items-center" id="right-footer">
                    <i class="fa-regular fa-smile mx-4 ms-text-grey-darker"></i>
                    <div class="input-group" @focusin="isWriting = !isWriting" @focusout="isWriting = !isWriting">
                        <input :class="newMessage !== ''? '':'rounded'"
                            class="form-control border-0 ms-text-sm py-3 ms-text-grey-darker" type="text"
                            placeholder="Scrivi un messaggio" id="message-input" v-model="newMessage"
                            @keyup.enter="addNewMessage()">
                        <button :class="newMessage !== ''? '' : 'd-none'" class="btn bg-white text-danger"
                            @click="newMessage = ''">
                            <i class="fa-solid fa-x"></i>
                        </button>
                    </div>
                    <i :class="newMessage !== ''? 'd-none' : ''" class="fa fa-microphone mx-4 ms-text-grey-darker"></i>
                    <button :class="newMessage !== ''? '' : 'd-none'" class="btn bg-transparent p-3 rounded-0"
                        @click="addNewMessage()">
                        <i class="fa fa-paper-plane mx-1 ms-text-grey-darker"></i>
                    </button>
                </footer>
                <!-- /#right-footer -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /#app -->

    <!-- Luxon CDN Lib -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <!-- Vue CDN Global -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- My script -->
    <script src="./assets/js/app.js"></script>
</body>

</html>